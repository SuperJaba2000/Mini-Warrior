<!DOCTYPE html>
<html>
    <head>  
    <meta charset="utf-8" />
    <title>generator</title>
	<link rel="stylesheet" href="assets/genStyle.css">
   </head>
    <body>
		<div class="settings" align="center">
		            <p><h3>GENERATOR SETTINGS</h3><br>
					
					<h4>name: <input type="text" id="name" size="20" maxLength="18" value="Unknown"></h4>
					<h4>autor: <input type="text" id="autor" size="20" maxLength="18" value="Unknown"></h4><br>
					
					<p><h6>
                        height: <input type="text" id="height" value="250">
                        width:  <input type="text" id="width" value="250">
					<h6></p><br>
					
					<h6>
					    type: <select id="genType">
                            <option>noise</option>
                            <option>random</option>
                        </select>
						seed: <input type="text" id="seed" size="4"><br>
						
						<br><input type="button" id="generate" value="generate"><br>
						<br><a download="map.mwsave" href="#" id="save">save map</a>
					</h6>
					
				    <!--<br><br><big>Generator type:</big><br>
				    <a>
				        <input type="radio" name="genType" value="noise" checked="true" >Noise(use noise function)<br>
                        <input type="radio" name="genType" value="random">Random(messy blocks)<br>
				    </a><br>
					
				    <a>
				        <input type="button" value="Generate!">
					    <input type="reset" value="Reset values">
				    </a>-->
        </div>
		
		<div class="preview">
		    <p><h3 align="center">MAP PREVIEW</h3></p>
			<canvas id="map"></canvas>
		</div>
		
		<script src='util/random.js'></script>
		<script src='util/noise.js'></script>
		<script src='util/generator.js'></script>
		
		<script src='content/blocks.js'></script>
		<script src='content/entities.js'></script>
		<script src='content/player-classes.js'></script>
		<script src='content/map.js'></script>
		
		<script>
		        const n = null; let pMap = null;
		
                        generate.onclick = function(){
				pMap = new Map(document.getElementById("name").value, width.value, height.value, seed.value, "auto generate");	
				
                                let map = document.getElementById("map");
				
				map.width = pMap.width;  map.height = pMap.height;
				const draw = map.getContext("2d");
	                        draw.clearRect(0, 0, map.width, map.height)
	
	                        for(var y = 0; y < pMap.height; y++){
                                       for (var x = 0; x < pMap.width; x++){
                                                if(x >= 0 && y >= 0 && pMap.tiles[y] !== undefined && getTile(x, y) !== undefined){			
			                                let tile = getTile(x, y);
			                                let tileInfo = getTileInfo(tile);
					
			                                if(tileInfo.hasBlock){
                                                                //draw block on map preview
                                                                draw.fillStyle = tile.block.color; 
	                                                        draw.fillRect(x, y, 1, 1);	
				                        }else{
					                        //draw block on map preview
                                                                draw.fillStyle = tile.floor.color; 
	                                                        draw.fillRect(x, y, 1, 1);
				                        }
			                        }
                                        }
                                }								
			}
			
			save.onclick = function(){
                                let mapJson = JSON.stringify(pMap, null, 2);
				save.download = '"'+document.getElementById("name").value+'"'+" by "+ autor.value + ".mwsave";
                                save.href = URL.createObjectURL( new Blob([mapJson], {type: "text/plain;charset=UTF-8"}) );
			}
		</script>
    </body>
</html>
