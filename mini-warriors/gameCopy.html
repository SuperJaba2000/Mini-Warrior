<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Mini|Warriors</title>
        <link rel="stylesheet" href="assets/gameStyle.css">
    </head>
    <body>
	    <div id="scene">
		    <canvas id="world"></canvas>
		    <a id="version" align="left"></a><br>
		    <a id="coordinates" align="left"></a>
		    <a id="biome" align="left"></a>
		    <canvas id="inventory"></canvas>
                         <input type="button" id="left" value="L">
                         <input type="button" id="up" value="U">
                         <input type="button" id="down" value="D">
                         <input type="button" id="right" value="R">
		    <canvas id="mini_map"></canvas>
			
			<button id="pause" height="64px" width="64px" onclick="changePause()"> 
		        <img src="assets/sprites/ui/pause.png" alt="pause" style="vertical-align: middle">
		    </button>
			
			<a id="text_textures">textures</a>
			<label id="switch_textures">
                <input id="textures" type="checkbox" onclick="changeTex()">
                <span class="slider"></span>
            </label>
		</div>
		
		<script src="arc/Vars.js"></script>
		<script src="arc/Graphic.js"></script>
		<script src="arc/Control.js"></script>
		
		<script src='util/random.js'></script>
		<script src='util/noise.js'></script>
		<script src='util/generator.js'></script>
		
		<script src='content/blocks.js'></script>
		<script src='content/map.js'></script>
		<script src='content/player.js'></script>

		<script>
		
		        //load textures
				
		        function getTexture(dir){
                                return "assets/sprites/"+dir+".png";
                       }
				
			//barrierFloor = ;	//what??
                        grassFloor.textures[0] = new Image(); grassFloor.textures[0].src=getTexture("floors/grass-floor");
                        sandFloor.textures[0] = new Image(); sandFloor.textures[0].src=getTexture("floors/sand-floor");
                        stoneFloor.textures[0] = new Image(); stoneFloor.textures[0].src=getTexture("floors/stone-floor");
                        snowFloor.textures[0] = new Image(); snowFloor.textures[0].src=getTexture("floors/snow-floor");
                        //brickFloor.textures[0] = new Image(); brickFloor.textures[0].src=getTexture("floors/brick-floor");

                        //liquids
				
                        water.textures[0] = new Image(); water.textures[0].src=getTexture("floors/water");
                        deepWater.textures[0] = new Image(); deepWater.textures[0].src=getTexture("floors/deep-water");
			
                        //blocks
			
                        barrierBlock.textures[0] = new Image(); barrierBlock.textures[0].src=getTexture("floors/deep-water");
                        /*const grassBlock = new Block("grass-block", "#32CD32", 0);
                        const sandBlock = new Block("sand-block", "#BDB76B", 0);
                        const brickBlock = new Block("brick-block", "#B22222", 0);
            */						
				
			//consts
		  
		        const worldDraw = world.getContext("2d");
                        const inventoryDraw = inventory.getContext("2d");
			
			let pMap = new Map("test", 500, 250, Math.random(), gameVersion);// debug seed is 12345
			
			function resizing(){
			        var tileSize = Settings.debug.tileSize;
			        
					let h = Math.round(window.innerHeight  / tileSize);//-1
			        screenSize.height = h > window.innerHeight ? h-1 : h;
					let w = Math.round(window.innerWidth / tileSize);//-1
				screenSize.width = w > window.innerWidth ? w-1 : w;
					
				world.height = screenSize.height * tileSize;
				world.width = screenSize.width * tileSize;
				
				scene.height = world.height;
				scene.width = world.width;
				
				//inventory.style.bottom = "0px";
			}
			
			resizing();
		
                        /// /// /// /// /// /// /// /// /// /// /// /// /// 
		        /// /// /// /// /// /// /// /// /// /// /// /// /// 
		        /// /// /// /// /// /// /// /// /// /// /// /// ///
			
                        function save(){
                                let file = new Blob([JSON.stringify(pMap, null, 2)], {type: 'text/plain'});
                                /*save.href = URL.createObjectURL(file);*/
				return file;
			}
			
			function changePause(){
				Settings.debug.pause = Settings.debug.pause ? false : true;
			}
			
			function changeTex(){
			        if (textures.checked){
                                        Settings.graphics.useTextures = true;
                                }else{
                                        Settings.graphics.useTextures = false;
                                }
				draw();
		        }
			
			function menu(){
			        const menu = window.open('../index.html','Menu');
                                window.close()
			}
			
			function gen(){
			        alert(map_height);
			}
			
                        /// /// /// /// /// /// /// /// /// /// /// /// /// 
		        /// /// /// /// /// /// /// /// /// /// /// /// /// 
		        /// /// /// /// /// /// /// /// /// /// /// /// ///
			
			/*function update() {
			
			    if(!pause){
				
				setStyles();
				
				quantHeight = map.tiles.length, quantWidth = map.tiles[0].length;
				
			    world.height = quantHeight * tileSize;
			    world.width = quantWidth * tileSize;
			
			    //clear canvas
                worldDraw.clearRect(0, 0, world.width, world.height)
				inventoryDraw.clearRect(0, 0, inventory.width, inventory.height)

                //draw new
				drawInventoryLine()
                drawTiles()
				
                drawPlayer()
				
				}
            }*/
			
		    
			
		function update() {
			version.innerHTML = "Version: " + gameVersion;
			
			if(!Settings.debug.pause){
				
				pMap.player.x = pTile().x;
				pMap.player.y = pTile().y;
			}
			coordinates.innerHTML = "x: " + pMap.player.x + " y: " + pMap.player.y;
			biome.innerHTML = "biome: " + pTile().biome;
                }

                let intervalUpdate = setInterval(() => update(), 10);
		setTimeout(draw(), 1000);
			
		</script>
    </body>
</html>
